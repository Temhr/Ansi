---

- name: system setup | cron | Check if ansible-pull logfile exists
  ansible.builtin.stat:
    path: /tmp/AnsiLog.txt
  register: ansilog_file

- name: system setup | cron | auto ansible-pull logfile
  tags: cron
  ansible.builtin.file:
    path: /tmp/AnsiLog.txt
    owner: ansibot
    group: root
    mode: 0664
    state: touch
  when: not ansilog_file.stat.exists

- name: system setup | cron | auto ansible-pull setup
  tags: cron
  ansible.builtin.cron:
    name: "ansible provision"
    user: ansibot
    minute: "*/17"
    job: "/usr/bin/ansible-pull -o -U https://github.com/Temhr/Ansi.git > /tmp/AnsiLog.txt"

- name: system setup | cron | Check if quarter daily logfile exists
  ansible.builtin.stat:
    path: /tmp/Ansi.txt
  register: ansi_file

- name: system setup | cron | auto ansible-pull log file
  tags: cron
  ansible.builtin.file:
    path: /tmp/Ansi.txt
    owner: ansibot
    group: root
    mode: 0664
    state: touch
  when: not ansi_file.stat.exists

- name: system setup | cron | quarter daily update/upgrade
  tags: cron
  ansible.builtin.cron:
    name: "ansible quarter daily"
    user: ansibot
    hour: "*/6"
    job: "ansible-playbook /usr/local/bin/quarter_daily_ansi.yml > /tmp/Ansi.txt"

- name: Create two soft links
  ansible.builtin.file:
    src: '/home/temhr/{{ item.src }}'
    dest: '/tmp/{{ item.dest }}'
    owner: temhr
    group: root
    mode: 0770
    state: link
  with_items:
    - { src: AnsiLog.txt, dest: AnsiLog.txt }
    - { src: Ansi.txt, dest: Ansi.txt }

#- name: system setup | cron | schedule automatic ansible provisioning
#  tags: cron
#  ansible.builtin.cron:
#    name: "ansible provision"
#    user: ansibot
#    hour: "{{ ansible_cron_hour | default('*') }}"
#    minute: "{{ ansible_cron_minute | default('*/5') }}"
#    job: "/usr/local/bin/provision > /home/AnsiLog.txt"

- name: system setup | cron | start service on boot
  tags: cron,systemd_service,boot
  ansible.builtin.systemd_service:
    name: cron
    enabled: True
    state: started

- name: system setup | cron | schedule ansible cleanup at boot
  tags: cron
  ansible.builtin.cron:
    name: "ansible refresh at boot"
    user: ansibot
    special_time: reboot
    job: "/bin/rm -rf /home/ansibot/.ansible"

#- name: system setup | cron | reboot service
#  tags: cron,systemd_service,reboot
#  ansible.builtin.systemd_service:
#    name: cron
#    state: restarted
